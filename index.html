<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stellar University</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/heroicons/2.1.3/24/outline/hero-icons.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <style>
        /* Simple, clean mobile styles */
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* Prevent iOS zoom on input focus */
        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="number"] {
            font-size: 16px;
        }
        
        /* Mobile navigation menu */
        .mobile-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 50;
            width: 100%;
            min-height: 200px;
        }
        
        /* Mobile menu items */
        .mobile-menu a,
        .mobile-menu button {
            display: block;
            width: 100%;
            text-align: left;
            padding: 12px 16px;
            border: none;
            background: none;
            font-size: 16px;
            min-height: 48px;
            display: flex;
            align-items: center;
        }
        
        /* Touch-friendly buttons */
        button, a {
            min-height: 44px;
            min-width: 44px;
        }
        
        /* Mobile responsive container */
        @media (max-width: 768px) {
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            /* Stack grid items on mobile */
            .mobile-stack {
                grid-template-columns: 1fr !important;
            }
            
            /* Mobile form spacing */
            .mobile-form {
                margin: 0 1rem;
            }
            
            /* Mobile button sizing */
            .mobile-btn {
                padding: 12px 20px;
                font-size: 16px;
                min-height: 48px;
            }
            

            
                    /* Mobile navigation toggle button */
        #mobile-menu-toggle {
            display: block !important;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            cursor: pointer;
        }
            
            /* Hide desktop navigation on mobile */
            .desktop-nav {
                display: none !important;
            }
        }
        
        /* Desktop styles */
        @media (min-width: 769px) {
            .mobile-menu {
                display: none !important;
            }
            
            #mobile-menu-toggle {
                display: none !important;
            }
            
            .desktop-nav {
                display: flex !important;
            }
        }
        
        /* Mobile menu animation */
        .mobile-menu {
            transition: all 0.3s ease-in-out;
        }
        
        /* Mobile menu items */
        .mobile-menu a,
        .mobile-menu button {
            display: block;
            width: 100%;
            text-align: left;
            padding: 12px 16px;
            border: none;
            background: none;
            font-size: 16px;
            min-height: 48px;
            display: flex;
            align-items: center;
        }
        
        /* Touch-friendly buttons */
        button, a {
            min-height: 44px;
            min-width: 44px;
        }
        
        /* Mobile menu item hover effects */
        .mobile-menu a:hover,
        .mobile-menu button:hover {
            background-color: #f9fafb;
            color: #4f46e5;
        }
        
        /* Mobile form improvements */
        @media (max-width: 768px) {
            input, select, textarea {
                font-size: 16px !important;
                padding: 12px 16px !important;
                min-height: 48px !important;
            }
            
            button[type="submit"] {
                padding: 14px 20px !important;
                font-size: 16px !important;
                min-height: 48px !important;
            }
            
            /* Mobile grid adjustments */
            .mobile-stack {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
            }
            
            /* Mobile modal improvements */
            .mobile-modal {
                width: 90vw !important;
                max-width: 400px !important;
                margin: 1rem !important;
            }
            
                    /* Mobile button improvements */
        .mobile-button {
            padding: 12px 20px !important;
            font-size: 16px !important;
            min-height: 48px !important;
            width: 100% !important;
        }
        
        /* Enhanced mobile navigation toggle */
        #mobile-menu-toggle {
            min-height: 48px !important;
            min-width: 48px !important;
            padding: 12px !important;
            touch-action: manipulation !important;
            -webkit-tap-highlight-color: transparent !important;
            -webkit-user-select: none !important;
            user-select: none !important;
        }
        
        /* Force hide elements when they should be hidden */
        .hidden {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-inter min-h-screen flex flex-col antialiased">

    <div id="modal-overlay" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden transition-opacity duration-300 z-50 justify-center items-center">
        <div class="bg-white p-6 rounded-lg shadow-xl w-80 max-w-[90vw] transform transition-transform duration-300 scale-95">
            <h3 id="modal-title" class="text-xl font-bold mb-2"></h3>
            <p id="modal-message" class="text-gray-600"></p>
            <div class="mt-4 flex justify-end">
                <button onclick="hideModal()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors">
                    Close
                </button>
            </div>
        </div>
    </div>

    <nav class="bg-white shadow-sm sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4 flex items-center justify-between">
            <a href="#" onclick="showPage('home')" class="flex items-center space-x-2">
                <span class="text-indigo-600 text-lg md:text-2xl font-bold">Stellar University</span>
                <div class="bg-indigo-600 w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center text-white font-bold text-xs md:text-sm">SU</div>
            </a>
            
            <!-- Desktop Navigation -->
            <div class="desktop-nav hidden md:flex space-x-4 items-center">
                <a href="#" onclick="showPage('home')" class="text-gray-600 hover:text-indigo-600 transition-colors">Home</a>
                <a href="#" onclick="showPage('about')" class="text-gray-600 hover:text-indigo-600 transition-colors">About</a>
                <a href="#" onclick="showPage('registration')" class="text-gray-600 hover:text-indigo-600 transition-colors">Register</a>
                <a href="#" onclick="showPage('dashboard')" 
                   id="dashboardLink"
                   class="hidden text-gray-600 hover:text-indigo-600 transition-colors">Dashboard</a>
                <a href="#" onclick="showPage('login')" 
                   id="loginLink"
                   class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors">
                   Login
                </a>
                <button id="logoutBtn" 
                        onclick="logoutUser()" 
                        class="hidden px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors">
                   Logout
                </button>
            </div>
            
            <!-- Mobile Navigation Toggle -->
            <button id="mobile-menu-toggle" onclick="toggleMobileMenu()" class="md:hidden p-2 rounded-md text-gray-600 hover:text-indigo-600 hover:bg-gray-100 transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </div>
        
        <!-- Mobile Navigation Menu -->
        <div id="mobile-menu" class="md:hidden hidden mobile-menu">
            <div class="px-4 py-2 space-y-1">
                <a href="#" onclick="showPage('home'); toggleMobileMenu()" class="text-gray-600 hover:text-indigo-600 hover:bg-gray-50 rounded-md transition-colors">Home</a>
                <a href="#" onclick="showPage('about'); toggleMobileMenu()" class="text-gray-600 hover:text-indigo-600 hover:bg-gray-50 rounded-md transition-colors">About</a>
                <a href="#" onclick="showPage('registration'); toggleMobileMenu()" class="text-gray-600 hover:text-indigo-600 hover:bg-gray-50 rounded-md transition-colors">Register</a>
                <a href="#" onclick="showPage('dashboard'); toggleMobileMenu()" 
                   id="mobileDashboardLink"
                   class="hidden text-gray-600 hover:text-indigo-600 hover:bg-gray-50 rounded-md transition-colors">Dashboard</a>
                <a href="#" onclick="showPage('login'); toggleMobileMenu()" 
                   id="mobileLoginLink"
                   class="text-gray-600 hover:text-indigo-600 hover:bg-gray-50 rounded-md transition-colors">Login</a>
                <button id="mobileLogoutBtn" 
                        onclick="logoutUser(); toggleMobileMenu()" 
                        class="hidden w-full text-left text-gray-600 hover:text-indigo-600 hover:bg-gray-50 rounded-md transition-colors">
                   Logout
                </button>
            </div>
        </div>
    </nav>
    
    <div class="bg-yellow-100 text-yellow-800 text-sm text-center py-2 px-4 shadow-sm" id="user-id">
        User ID: Not authenticated
    </div>

    <main class="container mx-auto flex-1 p-4 md:p-8">

        <section id="home-page" class="page-section">
            <div class="text-center py-8 md:py-12 lg:py-24">
                <h1 class="text-3xl md:text-4xl lg:text-6xl font-extrabold text-indigo-800 leading-tight px-4">Welcome to Stellar University</h1>
                <p class="mt-4 text-lg md:text-xl lg:text-2xl text-gray-600 max-w-2xl mx-auto px-4">
                    Where the future is shaped by knowledge and innovation.
                </p>
                <div class="mt-8 grid md:grid-cols-2 gap-6 md:gap-8 items-center max-w-4xl mx-auto px-4 mobile-stack">
                    <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                        <h2 class="text-xl md:text-2xl font-semibold text-indigo-700">Our Mission</h2>
                        <p class="mt-2 text-gray-600 text-lg">
                            To empower students with a holistic education that fosters critical thinking, creativity, and a commitment to lifelong learning. We strive to create global citizens prepared to solve the world's most pressing challenges.
                        </p>
                    </div>
                    <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                        <h2 class="text-xl md:text-2xl font-semibold text-indigo-700">Our Vision</h2>
                        <p class="mt-2 text-gray-600 text-lg">
                            To be a beacon of academic excellence and innovation, recognized for our impactful research and our diverse, inclusive community that inspires future leaders.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <section id="about-page" class="page-section hidden">
            <div class="py-8 md:py-12 lg:py-16 px-4">
                <h1 class="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900">About Stellar University</h1>
                <p class="mt-4 text-gray-700 text-lg leading-relaxed">
                    Stellar University, founded in 1985, has grown from a small liberal arts college into a leading institution of higher learning. Our commitment to academic rigor and a vibrant campus life has made us a top choice for students worldwide. We offer a wide range of programs across the arts, sciences, and professional fields.
                </p>
                <div class="mt-8 grid md:grid-cols-2 gap-6 md:gap-8 mobile-stack">
                    <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                        <h2 class="text-xl md:text-2xl font-semibold text-indigo-700">Campus Facilities</h2>
                        <ul class="mt-2 text-gray-600 list-disc list-inside text-lg">
                            <li>State-of-the-art laboratories</li>
                            <li>A modern library with extensive digital resources</li>
                            <li>Recreational sports complex</li>
                            <li>Student-run cafes and social hubs</li>
                        </ul>
                    </div>
                    <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                        <h2 class="text-xl md:text-2xl font-semibold text-indigo-700">Special Programs</h2>
                        <ul class="mt-2 text-gray-600 list-disc list-inside text-lg">
                            <li>Stellar Scholars Research Program</li>
                            <li>Global Immersion Study Abroad</li>
                            <li>Tech Innovation Incubator</li>
                            <li>Community Service Initiatives</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="registration-page" class="page-section hidden">
            <div class="py-8 md:py-12 max-w-2xl mx-auto bg-white rounded-lg shadow-lg mobile-form">
                <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-900 mb-6 p-4 md:p-8 pb-0">Student Registration</h1>
                <form onsubmit="registerUser(event)" class="space-y-4 md:space-y-6 p-4 md:p-8 pt-0">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
                        <input type="text" id="name" name="name" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                        <input type="email" id="email" name="email" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
                        <input type="text" id="username" name="username" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div class="grid md:grid-cols-2 gap-4 md:gap-6">
                        <div>
                            <label for="major" class="block text-sm font-medium text-gray-700">Intended Major</label>
                            <input type="text" id="major" name="major" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label for="year" class="block text-sm font-medium text-gray-700">Expected Enrollment Year</label>
                            <input type="number" id="year" name="year" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                        </div>
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                        <input type="password" id="password" name="password" required oninput="updatePasswordStrength()" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                        <div id="password-strength-meter" class="mt-2 h-2 rounded-full w-full bg-gray-200">
                            <div id="password-strength-bar" class="h-full rounded-full transition-all duration-300" style="width: 0%;"></div>
                        </div>
                        <p id="password-strength-text" class="text-sm mt-1"></p>
                    </div>
                    <button type="submit" class="w-full py-3 md:py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors mobile-btn">
                        Register
                    </button>
                </form>
            </div>
        </section>

        <section id="login-page" class="page-section hidden">
            <div class="py-8 md:py-12 max-w-sm mx-auto bg-white rounded-lg shadow-lg mobile-form">
                <div class="text-center mb-6 p-4 md:p-8 pb-0">
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100">
                       <svg class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                        </svg>
                    </div>
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mt-3">Member Login</h1>
                </div>

                <form onsubmit="loginUser(event)" class="space-y-4 md:space-y-6 p-4 md:p-8 pt-0">
                    <div>
                        <label for="login-username" class="block text-sm font-medium text-gray-700">Username</label>
                        <input type="text" id="login-username" name="username" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                         <div class="flex items-center justify-between">
                            <label for="login-password" class="block text-sm font-medium text-gray-700">Password</label>
                            <div class="text-sm">
                                <a href="#" onclick="forgotPassword(event)" class="font-semibold text-indigo-600 hover:text-indigo-500">Forgot password?</a>
                            </div>
                        </div>
                        <input type="password" id="login-password" name="password" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <button type="submit" class="w-full py-3 md:py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors mobile-btn">
                        Login
                    </button>
                </form>

                <p class="mt-6 text-center text-sm text-gray-500 p-4 md:p-8 pt-0">
                    Not a member?
                    <a href="#" onclick="showPage('registration')" class="font-semibold leading-6 text-indigo-600 hover:text-indigo-500">Register for an account</a>
                </p>
            </div>
        </section>

        <section id="dashboard-page" class="page-section hidden">
            <div class="py-8 md:py-12 max-w-3xl mx-auto px-4">
                <div class="text-center mb-8 md:mb-12">
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">Student Dashboard</h1>
                    <p class="text-lg text-gray-600">Welcome to your academic journey at Stellar University</p>
                </div>
                
                <!-- Student Info Card -->
                <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
                    <div class="bg-gradient-to-r from-indigo-500 to-purple-600 px-4 md:px-8 py-6">
                        <div class="flex items-center">
                            <div class="bg-white bg-opacity-20 p-3 rounded-full mr-4">
                                <svg class="h-6 md:h-8 w-6 md:w-8 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                                </svg>
                            </div>
                            <h2 class="text-xl md:text-2xl font-bold text-white">Student Information</h2>
                        </div>
                    </div>
                    
                    <div class="p-4 md:p-8">
                        <div class="grid gap-4 md:gap-6">
                            <div class="flex flex-col md:flex-row md:items-center py-4 border-b border-gray-100 last:border-b-0">
                                <div class="w-full md:w-32 text-sm font-medium text-gray-500 mb-2 md:mb-0">Full Name</div>
                                <div class="flex-1">
                                    <p id="dashboard-name" class="text-lg font-semibold text-gray-900">-</p>
                                </div>
                            </div>
                            
                            <div class="flex flex-col md:flex-row md:items-center py-4 border-b border-gray-100 last:border-b-0">
                                <div class="w-full md:w-32 text-sm font-medium text-gray-500 mb-2 md:mb-0">Major</div>
                                <div class="flex-1">
                                    <p id="dashboard-major" class="text-lg font-semibold text-gray-900">-</p>
                                </div>
                            </div>
                            
                            <div class="flex flex-col md:flex-row md:items-center py-4 border-b border-gray-100 last:border-b-0">
                                <div class="w-full md:w-32 text-sm font-medium text-gray-500 mb-2 md:mb-0">Enrollment Year</div>
                                <div class="flex-1">
                                    <p id="dashboard-year" class="text-lg font-semibold text-gray-900">-</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Welcome Message -->
                <div class="mt-8 text-center">
                    <div class="inline-block bg-gradient-to-r from-indigo-50 to-purple-50 rounded-2xl px-4 md:px-8 py-6 border border-indigo-100">
                        <h3 class="text-lg md:text-xl font-semibold text-indigo-900 mb-2">Ready to Excel?</h3>
                        <p class="text-indigo-700 text-lg">Your academic journey starts here. Make the most of your university experience!</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-gray-800 text-white py-6 mt-auto">
        <div class="container mx-auto text-center text-sm">
            &copy; 2025 Stellar University. All rights reserved.
        </div>
    </footer>

    <script>
        // Mobile Navigation Toggle
        function toggleMobileMenu() {
            console.log('toggleMobileMenu called!');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            
            if (mobileMenu.classList.contains('hidden')) {
                console.log('Opening mobile menu');
                mobileMenu.classList.remove('hidden');
                mobileMenuToggle.innerHTML = `
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                `;
            } else {
                console.log('Closing mobile menu');
                mobileMenu.classList.add('hidden');
                mobileMenuToggle.innerHTML = `
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                `;
            }
        }

        // Enhanced mobile touch handling
        function addMobileTouchHandling() {
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            if (mobileMenuToggle) {
                // Remove existing event listeners
                mobileMenuToggle.replaceWith(mobileMenuToggle.cloneNode(true));
                const newToggle = document.getElementById('mobile-menu-toggle');
                
                // Add multiple event types for maximum compatibility
                newToggle.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Touch start detected');
                    toggleMobileMenu();
                }, { passive: false });
                
                newToggle.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Touch end detected');
                }, { passive: false });
                
                newToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Click detected');
                    toggleMobileMenu();
                });
                
                // Add pointer events for modern browsers
                newToggle.addEventListener('pointerdown', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Pointer down detected');
                    toggleMobileMenu();
                }, { passive: false });
            }
        }

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            
            if (!mobileMenu.contains(event.target) && !mobileMenuToggle.contains(event.target)) {
                mobileMenu.classList.add('hidden');
                mobileMenuToggle.innerHTML = `
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                `;
            }
        });



        // Custom Modal Logic
        const modalOverlay = document.getElementById('modal-overlay');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');

        function showModal(type, message) {
            modalTitle.textContent = type === 'success' ? 'Success!' : 'Error!';
            modalTitle.classList.remove('text-red-600', 'text-green-600');
            modalTitle.classList.add(type === 'success' ? 'text-green-600' : 'text-red-600');
            modalMessage.textContent = message;
            modalOverlay.classList.remove('hidden');
            modalOverlay.classList.add('flex');
        }

        function hideModal() {
            modalOverlay.classList.add('hidden');
            modalOverlay.classList.remove('flex');
        }

        // Page Navigation Logic
        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(page => {
                page.classList.add('hidden');
            });
            const activePage = document.getElementById(`${pageId}-page`);
            if (activePage) {
                activePage.classList.remove('hidden');
            }
            
            // If navigating to dashboard, populate it with user data
            if (pageId === 'dashboard') {
                // Add a small delay to ensure Firebase is ready and elements are loaded
                setTimeout(() => {
                    populateDashboard();
                }, 100);
            }
        }

        // Password Strength Meter Logic
        function updatePasswordStrength() {
            const password = document.getElementById('password').value;
            const strengthBar = document.getElementById('password-strength-bar');
            const strengthText = document.getElementById('password-strength-text');
            let score = 0;
            let text = "Too short";
            let color = "bg-red-500"; // Use Tailwind bg colors

            if (password.length >= 8) {
                score++;
                text = "Weak";
                color = "bg-orange-500";
            }
            if (password.match(/[a-z]/) && password.match(/[A-Z]/)) {
                score++;
            }
            if (password.match(/[0-9]/)) {
                score++;
            }
            if (password.match(/[^a-zA-Z0-9]/)) {
                score++;
            }

            // Update text and color based on score
            if (score >= 3) {
                text = "Strong";
                color = "bg-green-500";
            } else if (score >= 2) {
                text = "Medium";
                color = "bg-yellow-500";
            }

            const width = (score / 4) * 100;
            strengthBar.style.width = `${width}%`;
            // Remove old color classes and add the new one
            strengthBar.classList.remove('bg-red-500', 'bg-orange-500', 'bg-yellow-500', 'bg-green-500');
            if (password.length > 0) {
                 strengthBar.classList.add(color);
            }
            strengthText.textContent = text;
        }

        // Make mobile navigation functions globally available
        window.toggleMobileMenu = toggleMobileMenu;
    </script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        // ## ADD sendPasswordResetEmail ##
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, sendPasswordResetEmail } 
        from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, where, query, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Firebase configuration remains the same
        const firebaseConfig = {
            apiKey: "AIzaSyDiY6DtTQZdm6uHhNWWh6h3FsMwaBoJzKk",
            authDomain: "stellar-student-hub.firebaseapp.com",
            projectId: "stellar-student-hub",
            storageBucket: "stellar-student-hub.firebasestorage.app",
            messagingSenderId: "494604224449",
            appId: "1:494604224449:web:7ac5b154a7e514cf339140"
        };
        const appId = "stellar-student-hub";
        
        let db, auth;
        
        async function initFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                
                onAuthStateChanged(auth, (user) => {
                    console.log('Auth state changed:', user ? 'User logged in' : 'User logged out');
                    
                    const logoutBtn = document.getElementById("logoutBtn");
                    const loginLink = document.getElementById("loginLink");
                    const dashboardLink = document.getElementById("dashboardLink");
                    const registerLink = document.querySelector('a[onclick="showPage(\'registration\')"]');
                    
                    // Mobile navigation elements
                    const mobileLogoutBtn = document.getElementById("mobileLogoutBtn");
                    const mobileLoginLink = document.getElementById("mobileLoginLink");
                    const mobileDashboardLink = document.getElementById("mobileDashboardLink");
                    
                    // Debug: Log all found elements
                    console.log('Found elements:', {
                        logoutBtn: logoutBtn,
                        loginLink: loginLink,
                        dashboardLink: dashboardLink,
                        registerLink: registerLink,
                        mobileLogoutBtn: mobileLogoutBtn,
                        mobileLoginLink: mobileLoginLink,
                        mobileDashboardLink: mobileDashboardLink
                    });
                    
                    if (user) {
                        console.log('User is logged in, updating navigation...');
                        document.getElementById('user-id').innerText = `User ID: ${user.uid}`;
                        
                        // Desktop navigation
                        if (logoutBtn) logoutBtn.classList.remove('hidden');
                        if (loginLink) loginLink.classList.add('hidden');
                        if (dashboardLink) dashboardLink.classList.remove('hidden');
                        if (registerLink) registerLink.classList.add('hidden');
                        
                        // Mobile navigation
                        if (mobileLogoutBtn) {
                            mobileLogoutBtn.classList.remove('hidden');
                            mobileLogoutBtn.style.display = 'block';
                        }
                        if (mobileLoginLink) {
                            mobileLoginLink.classList.add('hidden');
                            mobileLoginLink.style.display = 'none';
                        }
                        if (mobileDashboardLink) {
                            mobileDashboardLink.classList.remove('hidden');
                            mobileDashboardLink.style.display = 'block';
                        }
                    } else {
                        console.log('User is logged out, updating navigation...');
                        document.getElementById('user-id').innerText = 'User ID: Not authenticated';
                        
                        // Desktop navigation
                        if (logoutBtn) logoutBtn.classList.add('hidden');
                        if (loginLink) loginLink.classList.remove('hidden');
                        if (dashboardLink) dashboardLink.classList.add('hidden');
                        if (registerLink) registerLink.classList.remove('hidden');
                        
                        // Mobile navigation
                        if (mobileLogoutBtn) {
                            mobileLogoutBtn.classList.add('hidden');
                            mobileLogoutBtn.style.display = 'none';
                        }
                        if (mobileLoginLink) {
                            mobileLoginLink.classList.remove('hidden');
                            mobileLoginLink.style.display = 'block';
                        }
                        if (mobileDashboardLink) {
                            mobileDashboardLink.classList.add('hidden');
                            mobileDashboardLink.style.display = 'none';
                        }
                    }
                                 });
                 
                 // Update navigation state after Firebase auth is ready
                 setTimeout(() => {
                     console.log('Firebase auth ready, updating navigation state...');
                     updateNavigationState();
                     checkNavigationState();
                 }, 200);
                 
             } catch (error) {
                 console.error("Firebase initialization failed:", error);
                 showModal('error', `Firebase initialization failed: ${error.message}`);
             }
        }

        // Expose functions to the global scope
        window.registerUser = registerUser;
        window.loginUser = loginUser;
        window.logoutUser = logoutUser;
        // ## EXPOSE NEW forgotPassword FUNCTION ##
        window.forgotPassword = forgotPassword;

        // Make globally available from the non-module script
        window.showPage = showPage;
        window.updatePasswordStrength = updatePasswordStrength;
        window.hideModal = hideModal;
        window.showModal = showModal;

        // Function to populate dashboard with user data
        async function populateDashboard() {
            try {
                // Get current user from auth
                const currentUser = auth.currentUser;
                
                if (currentUser) {
                    console.log("Current user:", currentUser.uid, currentUser.email);
                    
                    // Since users are stored by username in registration, we need to find the username first
                    // Look for user by email in the users collection
                    const usersRef = collection(db, `artifacts/${appId}/public/data/users`);
                    const q = query(usersRef, where("email", "==", currentUser.email));
                    const querySnapshot = await getDocs(q);
                    
                    if (!querySnapshot.empty) {
                        const userData = querySnapshot.docs[0].data();
                        console.log("User data found:", userData);
                        
                        // Update dashboard fields
                        document.getElementById('dashboard-name').textContent = userData.name || 'Not specified';
                        document.getElementById('dashboard-major').textContent = userData.major || 'Not specified';
                        document.getElementById('dashboard-year').textContent = userData.year || 'Not specified';
                    } else {
                        console.log("No user data found for email:", currentUser.email);
                        // No user data found
                        document.getElementById('dashboard-name').textContent = 'No data found';
                        document.getElementById('dashboard-major').textContent = 'No data found';
                        document.getElementById('dashboard-year').textContent = 'No data found';
                    }
                } else {
                    console.log("No authenticated user");
                    // No authenticated user
                    document.getElementById('dashboard-name').textContent = 'Not authenticated';
                    document.getElementById('dashboard-major').textContent = 'Not authenticated';
                    document.getElementById('dashboard-year').textContent = 'Not authenticated';
                }
            } catch (error) {
                console.error("Error populating dashboard:", error);
                document.getElementById('dashboard-name').textContent = 'Error loading data';
                document.getElementById('dashboard-major').textContent = 'Error loading data';
                document.getElementById('dashboard-year').textContent = 'Error loading data';
            }
        }

        // Make populateDashboard globally available
        window.populateDashboard = populateDashboard;

        // Function to manually update navigation state
        function updateNavigationState() {
            const user = auth.currentUser;
            console.log('Manually updating navigation state for user:', user);
            
            const logoutBtn = document.getElementById("logoutBtn");
            const loginLink = document.getElementById("loginLink");
            const dashboardLink = document.getElementById("dashboardLink");
            const registerLink = document.querySelector('a[onclick="showPage(\'registration\')"]');
            
            // Mobile navigation elements
            const mobileLogoutBtn = document.getElementById("mobileLogoutBtn");
            const mobileLoginLink = document.getElementById("mobileLoginLink");
            const mobileDashboardLink = document.getElementById("mobileDashboardLink");
            
            // Debug: Log all found elements
            console.log('Navigation elements found:', {
                logoutBtn: logoutBtn,
                loginLink: loginLink,
                dashboardLink: dashboardLink,
                registerLink: registerLink,
                mobileLogoutBtn: mobileLogoutBtn,
                mobileLoginLink: mobileLoginLink,
                mobileDashboardLink: mobileDashboardLink
            });
            
            if (user) {
                console.log('User is logged in, updating navigation...');
                document.getElementById('user-id').innerText = `User ID: ${user.uid}`;
                
                // Desktop navigation
                if (logoutBtn) logoutBtn.classList.remove('hidden');
                if (loginLink) loginLink.classList.add('hidden');
                if (dashboardLink) dashboardLink.classList.remove('hidden');
                if (registerLink) registerLink.classList.add('hidden');
                
                // Mobile navigation
                if (mobileLogoutBtn) {
                    mobileLogoutBtn.classList.remove('hidden');
                    mobileLogoutBtn.style.display = 'block';
                }
                if (mobileLoginLink) {
                    mobileLoginLink.classList.add('hidden');
                    mobileLoginLink.style.display = 'none';
                }
                if (mobileDashboardLink) {
                    mobileDashboardLink.classList.remove('hidden');
                    mobileDashboardLink.style.display = 'block';
                }
            } else {
                console.log('User is logged out, updating navigation...');
                document.getElementById('user-id').innerText = 'User ID: Not authenticated';
                
                // Desktop navigation
                if (logoutBtn) logoutBtn.classList.add('hidden');
                if (loginLink) loginLink.classList.remove('hidden');
                if (dashboardLink) dashboardLink.classList.add('hidden');
                if (registerLink) registerLink.classList.remove('hidden');
                
                // Mobile navigation
                if (mobileLogoutBtn) {
                    mobileLogoutBtn.classList.add('hidden');
                    mobileLogoutBtn.style.display = 'none';
                }
                if (mobileLoginLink) {
                    mobileLoginLink.classList.remove('hidden');
                    mobileLoginLink.style.display = 'block';
                }
                if (mobileDashboardLink) {
                    mobileDashboardLink.classList.add('hidden');
                    mobileDashboardLink.style.display = 'none';
                }
            }
        }

        // Make updateNavigationState globally available
        window.updateNavigationState = updateNavigationState;
        
        // Function to check and fix navigation state
        function checkNavigationState() {
            console.log('Checking navigation state...');
            const user = auth.currentUser;
            
            // Get all navigation elements
            const logoutBtn = document.getElementById("logoutBtn");
            const loginLink = document.getElementById("loginLink");
            const dashboardLink = document.getElementById("dashboardLink");
            const registerLink = document.querySelector('a[onclick="showPage(\'registration\')"]');
            
            // Mobile navigation elements
            const mobileLogoutBtn = document.getElementById("mobileLogoutBtn");
            const mobileLoginLink = document.getElementById("mobileLoginLink");
            const mobileDashboardLink = document.getElementById("mobileDashboardLink");
            
            if (user) {
                console.log('User is logged in, ensuring correct navigation state...');
                // Desktop navigation
                if (logoutBtn) logoutBtn.classList.remove('hidden');
                if (loginLink) loginLink.classList.add('hidden');
                if (dashboardLink) dashboardLink.classList.remove('hidden');
                if (registerLink) registerLink.classList.add('hidden');
                
                // Mobile navigation
                if (mobileLogoutBtn) {
                    mobileLogoutBtn.classList.remove('hidden');
                    mobileLogoutBtn.style.display = 'block';
                }
                if (mobileLoginLink) {
                    mobileLoginLink.classList.add('hidden');
                    mobileLoginLink.style.display = 'none';
                }
                if (mobileDashboardLink) {
                    mobileDashboardLink.classList.remove('hidden');
                    mobileDashboardLink.style.display = 'block';
                }
            } else {
                console.log('User is logged out, ensuring correct navigation state...');
                // Desktop navigation
                if (logoutBtn) logoutBtn.classList.add('hidden');
                if (loginLink) loginLink.classList.remove('hidden');
                if (dashboardLink) dashboardLink.classList.add('hidden');
                if (registerLink) registerLink.classList.remove('hidden');
                
                // Mobile navigation - Force hide with both class and style
                if (mobileLogoutBtn) {
                    mobileLogoutBtn.classList.add('hidden');
                    mobileLogoutBtn.style.display = 'none';
                    console.log('Forced mobile logout button to hide');
                }
                if (mobileLoginLink) {
                    mobileLoginLink.classList.remove('hidden');
                    mobileLoginLink.style.display = 'block';
                }
                if (mobileDashboardLink) {
                    mobileDashboardLink.classList.add('hidden');
                    mobileDashboardLink.style.display = 'none';
                }
            }
        }
        
        // Make checkNavigationState globally available
        window.checkNavigationState = checkNavigationState;
        
        // Debug function to inspect current navigation state
        function debugNavigationState() {
            console.log('=== DEBUG NAVIGATION STATE ===');
            const user = auth.currentUser;
            console.log('Current user:', user);
            
            const mobileLogoutBtn = document.getElementById("mobileLogoutBtn");
            const mobileLoginLink = document.getElementById("mobileLoginLink");
            
            console.log('Mobile logout button:', mobileLogoutBtn);
            console.log('Mobile logout button classes:', mobileLogoutBtn ? mobileLogoutBtn.className : 'null');
            console.log('Mobile logout button hidden:', mobileLogoutBtn ? mobileLogoutBtn.classList.contains('hidden') : 'null');
            
            console.log('Mobile login link:', mobileLoginLink);
            console.log('Mobile login link classes:', mobileLoginLink ? mobileLoginLink.className : 'null');
            console.log('Mobile login link hidden:', mobileLoginLink ? mobileLoginLink.classList.contains('hidden') : 'null');
            
            console.log('=== END DEBUG ===');
        }
        
        // Make debug function globally available
        window.debugNavigationState = debugNavigationState;

        async function registerUser(event) {
             event.preventDefault();
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            const username = document.getElementById("username").value;
            const name = document.getElementById("name").value;
            const major = document.getElementById("major").value;
            const year = document.getElementById("year").value;

            if (!email || !password || !username || !name) {
                showModal('error', 'Please fill out all required fields.');
                return;
            }

            try {
                const userRef = doc(db, `artifacts/${appId}/public/data/users`, username);
                const docSnap = await getDoc(userRef);

                if (docSnap.exists()) {
                    showModal('error', 'Username already exists. Please choose a different one.');
                    return;
                }

                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                
                await setDoc(doc(db, `artifacts/${appId}/public/data/users`, username), {
                    name, email, username, major, year,
                    uid: userCredential.user.uid,
                    createdAt: new Date()
                });

                showModal('success', 'Registration successful! Redirecting to login...');
                setTimeout(() => showPage('login'), 1500);

            } catch (error) {
                console.error("Error during registration:", error);
                showModal('error', `Registration failed: ${error.message}`);
            }
        }

        async function loginUser(event) {
            event.preventDefault();
            const username = document.getElementById("login-username").value;
            const password = document.getElementById("login-password").value;

            if (!username || !password) {
                showModal('error', 'Please enter your username and password.');
                return;
            }

            try {
                const userRef = doc(db, `artifacts/${appId}/public/data/users`, username);
                const docSnap = await getDoc(userRef);

                if (!docSnap.exists()) {
                    showModal('error', 'Invalid username or password.');
                    return;
                }

                const userData = docSnap.data();
                const email = userData.email;

                await signInWithEmailAndPassword(auth, email, password);

                                 showModal('success', `Login successful! Welcome back, ${userData.name}.`);
                 setTimeout(() => {
                     hideModal();
                     showPage('dashboard');
                     // Update navigation state after successful login
                     setTimeout(() => {
                         updateNavigationState();
                         checkNavigationState();
                     }, 100);
                 }, 1500);

            } catch (error) {
                console.error("Error during login:", error);
                showModal('error', `Login failed: Invalid username or password.`);
            }
        }

        async function logoutUser() {
            try {
                await signOut(auth);
                                 showModal('success', 'You have been logged out.');
                 showPage('login');
                 // Update navigation state after logout
                 setTimeout(() => {
                     updateNavigationState();
                     checkNavigationState();
                 }, 100);
            } catch (error) {
                console.error("Error during logout:", error);
                showModal('error', `Logout failed: ${error.message}`);
            }
        }

        // ## NEW FORGOT PASSWORD FUNCTION ##
        async function forgotPassword(event) {
            event.preventDefault();
            const email = prompt("Please enter your email address to reset your password:");
                
            if (!email) {
                showModal('error', 'Email address is required for password reset.');
                return;
            }

            try {
                await sendPasswordResetEmail(auth, email);
                showModal('success', 'Password reset email sent! Please check your inbox.');
            } catch (error) {
                console.error("Error sending password reset email:", error);
                showModal('error', `Could not send reset email: ${error.message}`);
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            initFirebase();
            showPage('home');
            
            // Initialize enhanced mobile touch handling
            addMobileTouchHandling();
            
            // Force update navigation state after DOM is loaded
            setTimeout(() => {
                console.log('DOM loaded, forcing navigation state update...');
                updateNavigationState();
                checkNavigationState();
                
                // Force a second check after a longer delay to ensure everything is loaded
                setTimeout(() => {
                    console.log('Second check after DOM load...');
                    checkNavigationState();
                }, 1000);
            }, 500);
            
            // Set up periodic navigation state checks (but only if needed)
            let lastAuthState = null;
            setInterval(() => {
                const currentUser = auth.currentUser;
                if (currentUser !== lastAuthState) {
                    console.log('Auth state changed, updating navigation...');
                    lastAuthState = currentUser;
                    checkNavigationState();
                }
            }, 5000); // Check every 5 seconds, but only update if state changed
        });

    </script>
</body>
</html>
